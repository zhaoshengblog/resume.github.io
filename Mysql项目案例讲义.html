<!DOCTYPE html>
<html>
<head>
<title>Mysql项目案例讲义</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
@charset "UTF-8";

/*** Custom fonts ***/
@import url('./blubook/fonts.css');

/*** Color setting ***/
:root {
    --side-bar-bg-color: #183055;
    --active-file-bg-color: #2f4566;
    --active-file-text-color: #ffffff;
    --active-file-border-color: #757575;
    --active-search-item-bg-color: #23242b;
    --item-hover-bg-color: #ececec;
    --item-hover-text-color: #f5f7f9;
    --control-text-color: #ddd;
    --window-border: 1px solid #183055;
    --code-cursor: #f0f0f0;
}


/****** #write basic ******/
#write {
    position: static;
    width: 90%;
    max-width: 700px;
    line-height: 1.6;
    transform: none;
    height: auto;
}

/****** #write h1-h6 ******/
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre {
    width: auto;
  }
  
#write h1::before, #write h2::before, #write h3::before, #write h4::before, #write h5::before, #write h6::before {
  position: absolute;
  right: calc(100% + 10px);
  bottom: 0;
  color: #b4b4b4;
  font-size: 1rem;
  font-weight: bold;
  font-variant: 'small-caps';
  border: 0;
  border-radius: 0;
  left: auto;
  float: none;
  padding: 0;
  vertical-align: baseline;
  line-height: 2;
}

#write h1 {
  font-size: 32px;
  font-style: normal;
  font-weight: 800;
  line-height: 2;
  margin-top: 14px;
  margin-bottom: 14px;
}

#write h1::before {
  content: 'H1';
  bottom: 1rem;
}

#write h2 {
  font-size: 28px;
  font-weight: 800;
  font-style: normal;
  line-height: 2;
  margin-top: 14px;
  margin-bottom: 14px;
}

#write h2::before {
  content: 'H2';
  bottom: .85rem;
}

#write h3 {
  font-size: 24px;
  font-weight: 800;
  line-height: 2;
  font-style: normal;
  margin-top: 14px;
  margin-bottom: 14px;
}

#write h3::before {
  content: 'H3';
  bottom: .55rem;
}

#write h4 {
  font-size: 20px;
  font-weight: 800;
  line-height: 2;
  font-style: normal;
  margin-top: 14px;
  margin-bottom: 14px;
}

#write h4::before {
  content: 'H4';
  bottom: .35rem;
}

#write h5, #write h6 {
  font-size: 16px;
  font-weight: 800;
  line-height: 2;
  font-style: normal;
  margin-top: 14px;
  margin-bottom: 14px;
}

#write h5::before, #write h6::before {
  bottom: .1rem;
}

#write h5::before {
  content: 'H5';
}

#write h6::before {
  content: 'H6';
}

/****** Global Style ******/
body {
  margin: 0;
  font-family: "Glow Sans SC", "SF UI Display", ".PingFang SC", "Neue Haas Grotesk Text Pro", "Arial Nova", "Segoe UI", "Microsoft YaHei", "Microsoft JhengHei", "Helvetica Neue", "Source Han Sans SC", "Noto Sans CJK SC", "Source Han Sans CN", "Noto Sans SC", "Source Han Sans TC", "Noto Sans CJK TC", "Hiragino Sans GB", -apple-system, 'PingFang SC', sans-serif;
  font-weight: 500;
  text-rendering: geometricPrecision;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%
}

html, 
body {
  color: #242A31;
  /* width: 100%; */
  height: 100%;
  margin: 0;
  padding: 0;
  font-size: 15px;
  background: #ffffff;
  box-sizing: border-box;
  line-height: 1em;
  text-size-adjust: 100%;
  -moz-osx-font-smoothing: grayscale;
  -webkit-text-size-adjust: 100%;
} 

hr {
  border-color: #e6ecf1;
  height: 2px;
  border-top: 2px solid #e6ecf1;
}

img {
  max-width: 80%;
  margin-top: 0.2em;
  margin-bottom: 0.2em;
}

/****** ul ol Style ******/

ul>li>ul>li {
  list-style-type: circle;
}

ul>li>ul>li>ul>li {
  list-style-type: square;
}

ol,
ul {
  padding-left: 2em;
  line-height: 2;
}

ol>li {
  list-style-type: decimal
}

ol>li>ol>li {
  list-style-type: lower-alpha
}

ol>li>ol>li>ol>li {
  list-style-type: lower-roman
}

/****** Table Style ******/

table {
  padding: 0;
  word-break: initial;
}

table tr {
  border-top: 1px solid #dfe2e5;
  margin: 0;
  padding: 0;
}
table tr:nth-child(2n),
thead {
  background-color: #f5f7f9;
}
table tr th {
  font-weight: bold;
  border: 1px solid #dfe2e5;
  border-bottom: 0;
  margin: 0;
  padding: 6px 13px;
}
table tr td {
  border: 1px solid #dfe2e5;
  margin: 0;
  padding: 6px 13px;
}
table tr th:first-child,
table tr td:first-child {
  margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
  margin-bottom: 0;
}


/****** YAML Style ******/
pre.md-meta-block {
  font-size: .75rem !important;
  color: #5d5d5d;
  min-height: .8rem;
  white-space: pre-wrap;
  background: #f5f7f9;
  display: block;
  overflow-x: hidden;
  padding: 1rem;
  border-radius: 8px;
}



/****** Global Text ******/
p {
  font-size: 16px;
  font-family: "Glow Sans SC",'PingFang SC', -apple-system, "SF UI Display", ".PingFang SC", "Neue Haas Grotesk Text Pro", "Arial Nova", "Segoe UI", "Microsoft YaHei", "Microsoft JhengHei", "Helvetica Neue", "Source Han Sans SC", "Noto Sans CJK SC", "Source Han Sans CN", "Noto Sans SC", "Source Han Sans TC", "Noto Sans CJK TC", "Hiragino Sans GB", sans-serif;
  font-weight: 500;
  line-height: 1.6;
  font-style: normal;
  color: rgb(59, 69, 78);
}

a {
  /* color: rgb(164, 78, 237); */
  color: rgb(56, 132, 254);
  font-weight: 500;
  text-decoration: none;
  text-decoration-style: none;
  cursor: pointer;
  padding: 0 3px 0 3px;
}

#write a:hover {
  color: rgb(56, 132, 254);
  text-decoration: underline;
  text-decoration-style: solid;
}

strong {
  font-weight: 700;
}

h1 {
  font-size: 2rem;
  font-style: normal;
  font-weight: 800;
  line-height: 2;
  margin-top: 14px;
  margin-bottom: 14px;
}

h2 {
  font-size: 18px;
  font-weight: 800;
  font-style: normal;
  line-height: 2;
  margin-top: 14px;
  margin-bottom: 14px;
}

h3 {
  font-size: 16px;
  font-weight: 800;
  line-height: 2;
  font-style: normal;
  margin-top: 14px;
  margin-bottom: 14px;
}

h4 {
  font-size: 12px;
  font-weight: 800;
  line-height: 2;
  font-style: normal;
  margin-top: 14px;
  margin-bottom: 14px;
}

h5,  h6 {
  font-size: 1rem;
  font-weight: 800;
  line-height: 2;
  font-style: normal;
  margin-top: 14px;
  margin-bottom: 14px;
}


/****** #write Code Fences ******/
#write .md-fences {
    -webkit-font-smoothing: initial;
    margin: 1.8rem 0 2rem 0 !important;
    line-height: 1.43rem;
    border-radius: 3px;
    font-size: 0.95rem;
    word-wrap: normal;
}


#write .CodeMirror-wrap .CodeMirror-code pre {
    padding-left: 12px;
    line-height: 1.55rem;
}
  
#write .CodeMirror-cursors .CodeMirror-cursor {
    border-left: 2px solid var(--code-cursor);
}
  
#write code,
  tt {
    margin: 0 2px;
    padding: 4px 6px;
    border-radius: 6px;
    font-size: 0.92rem;
    background: #f5f7f9;
}
  
#write .md-footnote {
    color: var(--main-5);
    background-color: var(--main-1);
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  padding: 0.75rem 0.15rem 0.75rem 0.15rem;
  background-color: #183055 !important;
  color: #f8f8f2 !important;
  border: none;
  border-radius: 6px;
}


.code-tooltip {
  box-shadow: 0 1px 1px 0 rgba(0, 28, 36, .3);
  border-top: 1px solid #eef2f2;
  background: #183055;
  border-radius: 6px;
}

.md-fences {
  font-size: .9rem;
  position: relative!important;
  display: block;
  page-break-inside: avoid;
  text-align: left;
  overflow: visible;
  white-space: pre;
  background: inherit;
}

.md-fences {
  background-color: #f8f8f8;
  margin-bottom: 15px;
  margin-top: 15px;
  padding-top: 8px;
  padding-bottom: 6px;
}

.md-fences, tt {
  border-radius: 3px;
  color: #f0f0f0;
  padding: 0;
  font-size: 0.9em;
}

/****** Sidebar ******/
#typora-sidebar * {
  color: #f0f0f0;
}

#typora-sidebar .file-tree-node.file-library-file-node.active .file-node-background {
  border-left: 5px solid #3884ff;
  height: 2.6rem;
}

.file-list-item {
  border-bottom: var(--window-border);
}

.file-list-item {
  overflow: hidden;
  padding: 12px;
  border-bottom: 1px solid #eee;
  border-bottom: var(--window-border);
  cursor: pointer;
  padding-right: 8px;
  padding-top: 12px;
  padding-left: 24px;
  transition: top .5s;
  -webkit-transition: top .5s;
}

.file-list-item.active {
  background: #2f4566;
  /* background: var(--active-file-bg-color); */
  color: var(--active-file-text-color);
  border-radius: 12px;
}

.file-list-item:not(.active) {
  opacity: .9;
}

.file-node-content {
  padding-top: .8rem;
  margin-bottom: .8rem;
  cursor: default;
  color: var(--control-text-color);
  white-space: nowrap;
  height: 2rem;
}

.file-node-content:active {
  border-radius: 0px!important;
  background: #2f4566;
}

.active .file-node-content {
  font-weight: bold;
}

.file-node-content:hover {
  cursor: pointer;
  border-radius: 0px!important;
}

.file-node-icon, .file-node-open-state {
  display: block;
  float: left;
  line-height: 15px;
  min-height: 15px;
}

.file-node-icon {
  margin-right: 6px;
}

.sidebar-footer {
background: var(--side-bar-bg-color);
border-top: 1px #555 solid;
}

#typora-sidebar #ty-sidebar-footer .sidebar-footer-item:hover {
background: #021d43;
}

#typora-sidebar #outline-content .outline-item:hover {
background: #202020;
}

#typora-sidebar #ty-sidebar-footer #sidebar-files-menu .show + .menuitem-group-label.show {
border-color: #202020;
}

#typora-sidebar #ty-sidebar-footer {
border-top: 1px solid #19191c;
}

#typora-sidebar #ty-sidebar-footer #sidebar-files-menu li > a:hover {
background: #021d43;
}

#typora-sidebar #ty-sidebar-footer #sidebar-files-menu .ty-side-sort-btn.active, #typora-sidebar #ty-sidebar-footer #sidebar-files-menu .ty-side-sort-btn:hover {
color: #3884FF;
}

#typora-sidebar #ty-sidebar-footer #sidebar-files-menu .ty-side-sort-btn.active {
background: #001129;
}

#typora-sidebar .file-list-item.file-library-node:not(.active):hover {
  background: #243959;
  border-radius: 12px;
}

#typora-sidebar .file-tree-node.file-library-file-node:not(.active):hover .file-node-background {
  background: #243959;
  border-radius: 12px;
  height: 2.6rem;
}

/****** Quote style ******/
blockquote {
    position: relative;
  /*  margin: 1rem 1 1rem 2rem; */
    padding: 1rem;
    color: #827676;
    background-color: #f5f7f9;
    border-radius: 6px;
    line-height: 2;
}
  
blockquote::before {
    content: '';
    position: absolute;
    top: 0rem;
    left: 0rem;
    height: 100%;
    width: .30rem;
    background: #3884ff;
    border-top-left-radius: 6px;
    border-bottom-left-radius: 6px;
}


/****** Code style ******/
code {
    font-size:1em; 
    color: #1980ff;  
    /*border: 1px solid #d0d0d0; */
    font-family: 'Cascadia Code', Consolas, 'Noto Sans SC','Courier New', 'PingFang SC', "SF UI Display", ".PingFang SC", "Neue Haas Grotesk Text Pro", "Arial Nova", "Segoe UI", "Microsoft YaHei", "Microsoft JhengHei", "Helvetica Neue", "Source Han Sans SC", "Noto Sans CJK SC", "Source Han Sans CN", "Noto Sans SC", "Source Han Sans TC", "Noto Sans CJK TC", "Hiragino Sans GB", monospace;
    padding: .2em .2em;
    border-radius: 3px;
    background: #f5f7f9!important;
}  

pre{
    background: #f5f7f9  !important;
    border: 1px solid #B5D6FC /*#d0d0d0*/; 
    padding: 10px 10px;
    font-size: 90% !important;
    font-weight: normal;
    line-height:18px; 
    font-family: 'Cascadia Code', Consolas, 'Noto Sans SC','Courier New', 'PingFang SC', "SF UI Display", ".PingFang SC", "Neue Haas Grotesk Text Pro", "Arial Nova", "Segoe UI", "Microsoft YaHei", "Microsoft JhengHei", "Helvetica Neue", "Source Han Sans SC", "Noto Sans CJK SC", "Source Han Sans CN", "Noto Sans SC", "Source Han Sans TC", "Noto Sans CJK TC", "Hiragino Sans GB", monospace;
    -webkit-font-smoothing: initial;
    -moz-osx-font-smoothing: initial
}

/****** Code highlight ******/
.cm-s-inner .CodeMirror-guttermarker, .cm-s-inner .CodeMirror-guttermarker-subtle, .cm-s-inner .CodeMirror-linenumber { color: #596774; }
.cm-s-inner .CodeMirror-cursor { border-left: 1px solid #f8f8f0; }
.cm-s-inner div.CodeMirror-selected { background: rgba(255, 255, 255, 0.15); }
.cm-s-inner.CodeMirror-focused div.CodeMirror-selected { background: rgba(255, 255, 255, 0.10); }
.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line > span::selection, .cm-s-inner .CodeMirror-line > span > span::selection { background: rgba(255, 255, 255, 0.10); }
.cm-s-inner .CodeMirror-line::-moz-selection, .cm-s-inner .CodeMirror-line > span::-moz-selection, .cm-s-inner .CodeMirror-line > span > span::-moz-selection { background: rgba(255, 255, 255, 0.10); }

.cm-s-inner .CodeMirror-activeline-background { background: rgba(0, 0, 0, 0); }
.cm-s-inner .cm-keyword { color: rgba(199, 146, 234, 1); }
.cm-s-inner .cm-operator { color: rgba(233, 237, 237, 1); }
.cm-s-inner .cm-variable-2 { color: #80CBC4; }
.cm-s-inner .cm-variable-3 { color: #82B1FF; }
.cm-s-inner .cm-builtin { color: #DECB6B; }
.cm-s-inner .cm-atom { color: #F77669; }
.cm-s-inner .cm-number { color: #F77669; }
.cm-s-inner .cm-def { color: rgba(233, 237, 237, 1); }
.cm-s-inner .cm-string { color: #C3E88D; }
.cm-s-inner .cm-string-2 { color: #80CBC4; }
.cm-s-inner .cm-comment { color: #546E7A; }
.cm-s-inner .cm-variable { color: #82B1FF; }
.cm-s-inner .cm-tag { color: #80CBC4; }
.cm-s-inner .cm-meta { color: #80CBC4; }
.cm-s-inner .cm-attribute { color: #FFCB6B; }
.cm-s-inner .cm-property { color: #80CBAE; }
.cm-s-inner .cm-qualifier { color: #DECB6B; }
.cm-s-inner .cm-variable-3 { color: #DECB6B; }
.cm-s-inner .cm-tag { color: rgba(255, 83, 112, 1); }
.cm-s-inner .cm-error {
  color: rgba(255, 255, 255, 1.0);
  background-color: #EC5F67;
}
.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: white !important;
}

.md-fences .code-tooltip {
  background-color: #263238;
}
</style>
<style type="text/css">
.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
.pl-c {
    color: #969896;
}

.pl-c1,.pl-mdh,.pl-mm,.pl-mp,.pl-mr,.pl-s1 .pl-v,.pl-s3,.pl-sc,.pl-sv {
    color: #0086b3;
}

.pl-e,.pl-en {
    color: #795da3;
}

.pl-s1 .pl-s2,.pl-smi,.pl-smp,.pl-stj,.pl-vo,.pl-vpf {
    color: #333;
}

.pl-ent {
    color: #63a35c;
}

.pl-k,.pl-s,.pl-st {
    color: #a71d5d;
}

.pl-pds,.pl-s1,.pl-s1 .pl-pse .pl-s2,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre,.pl-src,.pl-v {
    color: #df5000;
}

.pl-id {
    color: #b52a1d;
}

.pl-ii {
    background-color: #b52a1d;
    color: #f8f8f8;
}

.pl-sr .pl-cce {
    color: #63a35c;
    font-weight: bold;
}

.pl-ml {
    color: #693a17;
}

.pl-mh,.pl-mh .pl-en,.pl-ms {
    color: #1d3e81;
    font-weight: bold;
}

.pl-mq {
    color: #008080;
}

.pl-mi {
    color: #333;
    font-style: italic;
}

.pl-mb {
    color: #333;
    font-weight: bold;
}

.pl-md,.pl-mdhf {
    background-color: #ffecec;
    color: #bd2c00;
}

.pl-mdht,.pl-mi1 {
    background-color: #eaffea;
    color: #55a532;
}

.pl-mdr {
    color: #795da3;
    font-weight: bold;
}

.pl-mo {
    color: #1d3e81;
}
.task-list {
padding-left:10px;
margin-bottom:0;
}

.task-list li {
    margin-left: 20px;
}

.task-list-item {
list-style-type:none;
padding-left:10px;
}

.task-list-item label {
font-weight:400;
}

.task-list-item.enabled label {
cursor:pointer;
}

.task-list-item+.task-list-item {
margin-top:3px;
}

.task-list-item-checkbox {
display:inline-block;
margin-left:-20px;
margin-right:3px;
vertical-align:1px;
}
</style>
<!-- 声明文档使用的字符编码 -->
    <meta charset='utf-8'>
    <!-- 优先使用 IE 最新版本和 Chrome -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <!-- 页面描述 -->
    <meta name="description" content="Assistants-用心做好一件事"/>
    <!-- 页面关键词 -->
    <meta name="keywords" content="Assistants-用心做好一件事"/>
    <!-- 网页作者 -->
    <meta name="author" content="name, email@gmail.com"/>
    <!-- 搜索引擎抓取 -->
    <meta name="robots" content="index,follow"/>
    <!-- 为移动设备添加 viewport -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
    <!-- `width=device-width` 会导致 iPhone 5 添加到主屏后以 WebApp 全屏模式打开页面时出现黑边 http://bigc.at/ios-webapp-viewport-meta.orz -->

    <!-- iOS 设备 begin -->
    <meta name="apple-mobile-web-app-title" content="标题">
    <!-- 添加到主屏后的标题（iOS 6 新增） -->
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <!-- 是否启用 WebApp 全屏模式，删除苹果默认的工具栏和菜单栏 -->

    <meta name="apple-itunes-app" content="app-id=myAppStoreID, affiliate-data=myAffiliateData, app-argument=myURL">
    <!-- 添加智能 App 广告条 Smart App Banner（iOS 6+ Safari） -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black"/>
    <!-- 设置苹果工具栏颜色 -->
    <meta name="format-detection" content="telphone=no, email=no"/>
    <!-- 忽略页面中的数字识别为电话，忽略email识别 -->
    <!-- 启用360浏览器的极速模式(webkit) -->
    <meta name="renderer" content="webkit">
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- 针对手持设备优化，主要是针对一些老的不识别viewport的浏览器，比如黑莓 -->
    <meta name="HandheldFriendly" content="true">
    <!-- 微软的老式浏览器 -->
    <meta name="MobileOptimized" content="320">
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <!-- iOS 图标 begin -->
    <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-57x57-precomposed.png"/>
    <!-- iPhone 和 iTouch，默认 57x57 像素，必须有 -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114-precomposed.png"/>
    <!-- Retina iPhone 和 Retina iTouch，114x114 像素，可以没有，但推荐有 -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144-precomposed.png"/>
    <!-- Retina iPad，144x144 像素，可以没有，但推荐有 -->
    <!-- iOS 图标 end -->

    <!-- iOS 启动画面 begin -->
    <link rel="apple-touch-startup-image" sizes="768x1004" href="/splash-screen-768x1004.png"/>
    <!-- iPad 竖屏 768 x 1004（标准分辨率） -->
    <link rel="apple-touch-startup-image" sizes="1536x2008" href="/splash-screen-1536x2008.png"/>
    <!-- iPad 竖屏 1536x2008（Retina） -->
    <link rel="apple-touch-startup-image" sizes="1024x748" href="/Default-Portrait-1024x748.png"/>
    <!-- iPad 横屏 1024x748（标准分辨率） -->
    <link rel="apple-touch-startup-image" sizes="2048x1496" href="/splash-screen-2048x1496.png"/>
    <!-- iPad 横屏 2048x1496（Retina） -->

    <link rel="apple-touch-startup-image" href="/splash-screen-320x480.png"/>
    <!-- iPhone/iPod Touch 竖屏 320x480 (标准分辨率) -->
    <link rel="apple-touch-startup-image" sizes="640x960" href="/splash-screen-640x960.png"/>
    <!-- iPhone/iPod Touch 竖屏 640x960 (Retina) -->
    <link rel="apple-touch-startup-image" sizes="640x1136" href="/splash-screen-640x1136.png"/>
    <!-- iPhone 5/iPod Touch 5 竖屏 640x1136 (Retina) -->
    <!-- iOS 启动画面 end -->

    <!-- iOS 设备 end -->
    <meta name="msapplication-TileColor" content="#000"/>
    <!-- Windows 8 磁贴颜色 -->
    <meta name="msapplication-TileImage" content="icon.png"/>
    <!-- Windows 8 磁贴图标 -->

    <link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"/>
    <!-- 添加 RSS 订阅 -->
    <link rel="shortcut icon" type="image/ico" href="/favicon.ico"/>
    <!-- 添加 favicon icon -->
    
<meta name='viewport' content='width=device-width initial-scale=1'>
<meta http-equiv="Expires" content="0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-control" content="no-cache">
<meta http-equiv="Cache" content="no-cache">
<!-- 去缓存 -->

<script src="https://unpkg.com/umoji@2.0.0/dist/umoji.umd.js"></script>
<!-- 表情包 -->

<link href="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/vs.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/highlight.min.js"></script>  
<script >hljs.initHighlightingOnLoad();</script> 


<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/96x96.ico" type="image/x-icon">
<script src="https://hm.baidu.com/hm.js?44b6fcd69c6e2f3250c2ade16f5b4622"></script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?44b6fcd69c6e2f3250c2ade16f5b4622";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<link href="https://cdn.bootcss.com/jquery.tocify/1.9.0/stylesheets/jquery.tocify.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/jquery/1.8.2/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jqueryui/1.10.1/jquery-ui.min.js"></script>
<script src="https://cdn.bootcss.com/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js"></script>

<style>
.tocCal{
	position: fixed;
	width: 400px;
	max-width: 450px;
	margin: 0px 0px 20px 0px;	
	top: 36px;	
	right:30px;	
	font-size: 13px;
	max-height:90%;		
	background-color: #0088CC;	
	border: 1px solid #ccc;
	webkit-border-radius: 6px;
	moz-border-radius: 6px;
	border-radius: 6px;
	color: white;
}

.toc {
	position: fixed;
	width: 400px;
	max-width: 450px;
	margin: 0px 0px 20px 0px;
	top: 60px;
	right:30px;	
	/*background: #f1f1f1;*/	
	background-color: #ffffff;
	
	font-size: 13px;
	max-height:86%;		
	
	border: 1px solid #ccc;
	webkit-border-radius: 6px;
	moz-border-radius: 6px;
	border-radius: 6px;
}

.nav-list > .active > a, .nav-list > .active > a:hover {
    color: #ffffff;
    text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.2);
    background-color: #0088cc;
}
</style>

<script type="text/javascript">
// ==UserScript==
// @name 窄边滚动条 (Narrow Scrollbar)
// @description 原始配色8px滚动条(仅适用于WebKit内核浏览器)
// @namespace https://github.com/ue1/userscripts
// @version 1.0.1
// @run-at document-start
// @include http*
// @compatible chrome
// @grant none
// ==/UserScript==
var _tag = "head|body|html".split("|");
for (var i = 0; i < _tag.length; i++) {
    var _head = document.getElementsByTagName(_tag[i])[0];
    if (!_head) continue;
    var _style = document.createElement('style');
    _style.setAttribute("type", "text/css");
    _style.innerHTML = "::-webkit-scrollbar{width:8px;height:8px;}::-webkit-scrollbar-thumb:hover{background-color:#a8a8a8;}::-webkit-scrollbar-thumb{background-color:#c0c0c0;}::-webkit-scrollbar-track-piece{background-color:#f1f1f1;}::-webkit-scrollbar-thumb:active{background-color:#787878;}";
    _head.appendChild(_style);
    break;
}
</script>

<script type="text/javascript">
    function wrapOldContentByDiv() {
        var oldContentDiv = document.createElement("div");
        oldContentDiv.style.cssText = "float:right; width:72%; padding-left: 3%; padding-right:3%;border: 2px solid #CACACA;";
        oldContentDiv.innerHTML = document.body.innerHTML;
        document.body.style["max-width"] = "100%";
        document.body.style["margin"] = "20px";
        document.body.style["padding"] = "0";
        document.body.innerHTML = '';
        document.body.appendChild(oldContentDiv);
    };

    function addDirectorySwitch(directoryDiv) {
        var directorySwitchP = document.createElement("p");
        directorySwitchP.style.cssText = "text-align: left; margin: 0;";
        directoryDiv.appendChild(directorySwitchP);

        var ele_span = document.createElement("span");
        ele_span.style.cssText = "font-weight: 1000;";
        var ele_text = document.createTextNode("目录");
        ele_span.appendChild(ele_text);

        var ele_a = document.createElement("a");
        ele_a.appendChild(document.createTextNode("[-]"));
        ele_a.setAttribute("href", "#");
        ele_a.setAttribute("onclick", "javascript:return switchAllDirectory(this);");
        ele_a.setAttribute("title", "Click to Open TOC");

        ele_span.appendChild(ele_a);
        directorySwitchP.appendChild(ele_span);
    }

    function createTree(parentNode, tags, index, maxLevel) {
        if (index >= tags.length) {
            return -1;
        }

        var lastLevel = -1;
        for (var i = index; i < tags.length; i++) {
            var header = tags[i];
            var level = parseInt(header.tagName.substr(1), 10);

            var childNode = {'tag': header, 'childNodes': [], 'level': level};
            if (level > parentNode.level) {
                if (lastLevel > 0 && level > lastLevel) {
                    // 子子类
                    index = createTree(parentNode.childNodes[parentNode.childNodes.length - 1], tags, i);
                    if (index < 0) {
                        return -1;
                    } else {
                        i = index - 1;
                    }
                } else {
                    parentNode.childNodes.push(childNode);
                    lastLevel = level;
                }
            } else if (level <= maxLevel && parentNode.level > maxLevel) {
                parentNode.childNodes.push(childNode);
                lastLevel = level;
            } else {
                return i;
            }
        }
    }

    function createAElement(tag, index) {
        var a = document.createElement("a");
        a.style.cssText = "";
        a.setAttribute("href", "#" + tag.textContent);
        a.innerHTML = index.toString() + tag.textContent;
        return a;
    }

    function createOlElement() {
        var ol_el = document.createElement("ol");
        ol_el.style["line-height"] = "180%";
        ol_el.style["list-style-type"] = "none";
        ol_el.style["margin-left"] = "0";
        return ol_el
    }

    function createEmptyLiElement() {
        var emptyLiEle = document.createElement("li");
        return emptyLiEle
    }

    function getIndex(parentDirectory, directoryLevel, index) {
        if (directoryLevel === 0) {
            return parentDirectory + (index + 1).toString() + "."
        } else {
            return parentDirectory + (index + 1).toString() + ".";
        }
    }

    function createLeafElement(node, curDirectory) {
        var liEle = createEmptyLiElement();
        var aEle = createAElement(node.tag, curDirectory);
        liEle.appendChild(aEle);
        return liEle
    }

    function getArrowDownStyle() {
        return " width: 0;" +
            "    height: 0;" +
            "    position: relative;" +
            "    margin-right: 8px;" +
            "    top: 3px;" +
            "    display: inline-block;" +
            "    border: 6px outset;" +
            "    border-color: black transparent transparent transparent;"
    }

    function getArrowRightStyle() {
        return " width: 0;" +
            "    height: 0;" +
            "    left: 5px;" +
            "    position: relative;" +
            "    margin-right: 8px;" +
            "    display: inline-block;" +
            "    border: 6px solid;" +
            "    border-color: transparent transparent transparent black;"
    }

    /*
    <ol>
        <li><a>根节点1</a></li>
        <li><a>根节点2</a></li>
        <li>
            <div>
                <a><span>[-]</span>根节点3</a>
                <ol>
                    <li><a>子节点1</a></li>
                    <li><a>子节点2</a></li>
                    <li><a>子节点3</a></li>
                </ol>
            </div>
        </li>
        <li><a>根节点4</a></li>
     </ol>
    * */
    // node, 1.2.3 4 0
    function renderTree(node, parentDirectory, directoryLevel, index) {
        var childNodes = node.childNodes;
        var tagContent = node.tag.textContent;

        node.tag.setAttribute("id", tagContent);

        var curDirectory = getIndex(parentDirectory, directoryLevel, index);
        var directoryName = curDirectory + "&nbsp;" + tagContent;

        // 叶子节点
        if (childNodes.length === 0) {
            return "<li style='padding-left: 24px;'><a href='#" + tagContent + "'>" + directoryName + "</a></li>"
    //                return createLeafElement(node, curDirectory)
        }

        // 非叶子节点
        var childContent = "";
        for (var j = 0; j < node.childNodes.length; j++) {
            childContent += renderTree(node.childNodes[j], curDirectory, directoryLevel + 1, j);
        }

        return "<li>" +
            "   <div>" +
            "      <div>" +
            "         <div id='" + directoryName + "' class='open' style='" + getArrowDownStyle() + "' onclick='return switchDirectory(this);'></div>" +
            "         <a href='#" + tagContent + "' ondblclick='return switchByDbClick(this);'>" + directoryName + "</a>" +
            "      </div>" +
            "      <ol id='ol-" + directoryName + "' style='line-height: 180%;list-style-type: none; padding-left: 20px;'>" + childContent + "</ol>" +
            "   </div>" +
            "</li>";

        /*var liEle = createEmptyLiElement();
        var aEle = createAElement(node.tag, curDirectory);

        var parentElement = document.createElement("div");
        parentElement.appendChild(aEle);

        var olElement = createOlElement();

        var tempNode;
        for (var j = 0; j < node.childNodes.length; j++) {
            tempNode = node.childNodes[j];
            var element = renderTree(tempNode, curDirectory, directoryLevel + 1, j);
            olElement.appendChild(element);
        }
        parentElement.appendChild(olElement);

        liEle.appendChild(parentElement);
        return liEle;*/
    }

    function switchByDbClick(aEle) {
        switchDirectory(aEle.parentElement().firstChild)
    }

    // 开关目录
    function switchDirectory(ele) {
        var divEle = ele.parentNode.parentNode;
        var olEle = divEle.lastElementChild;
        if (ele.className === "open") {
            // 关闭
            olEle.style.cssText = "display:none;line-height: 180%;list-style-type: none; padding-left: 20px";
            ele.setAttribute("class", "close");
            ele.style.cssText = getArrowRightStyle();
        } else if (ele.className === "close") {
            // 打开
            olEle.style.cssText = "line-height: 180%;list-style-type: none; padding-left: 20px";
            ele.setAttribute("class", "open");
            ele.style.cssText = getArrowDownStyle();
        }
    }

    function switchAllDirectory(e) {
        var rootOlElement = document.getElementById("outline_ol");
        var ols = rootOlElement.getElementsByTagName("ol");
        var isOpen = false;

        if (e.innerHTML === '[+]') {
            e.setAttribute('title', 'collapse');
            e.innerHTML = '[-]';
            isOpen = true;
        } else {
            e.setAttribute('title', 'expand');
            e.innerHTML = '[+]';
        }


        for (var i = 0; i < ols.length; i++) {
            var olEle = ols[i];
            if (isOpen) {
                olEle.style.display = "block";
                olEle.parentNode.firstElementChild.firstElementChild.style.cssText = getArrowDownStyle();
            } else {
                olEle.style.display = "none";
                olEle.parentNode.firstElementChild.firstElementChild.style.cssText = getArrowRightStyle();
            }
        }

        e.blur();
        return false;
    }

    document.addEventListener("DOMContentLoaded", function () {
        // 1, 将body内容提取到div标签中
        wrapOldContentByDiv();

        // 2, 创建左边目录列表Div
        var directoryDiv = document.createElement("div");
        directoryDiv.setAttribute("id", "outline-list");
        directoryDiv.style.cssText = "width:20%;height:100%; float:left;font-size:16px,z-index:1;position: fixed;overflow: hidden;";

        // 3, 目录展开折叠开关
        addDirectorySwitch(directoryDiv);

        // 4, 创建目录列表
        var directoryOl = document.createElement("ol");
        directoryOl.style.cssText = "padding-left:14px;line-height:180%;list-style-type:none;height: 85%;padding-bottom: 30px; overflow: auto;";
        directoryOl.setAttribute("id", "outline_ol");
        directoryDiv.appendChild(directoryOl);
        var div1 = document.createElement("div");
        div1.style.cssText = "clear:both";

        // 插入目录
        document.body.insertBefore(directoryDiv, document.body.childNodes[0]);

        // 5, 获取所有的H标签
        var hTags = document.querySelectorAll('h1,h2,h3,h4,h5,h6');
        if (hTags.length < 2)
            return;

        var rootNode = {'tag': directoryOl, 'childNodes': [], 'level': 0};
        var maxLevel = parseInt(hTags[0].tagName.substr(1), 10);
        // 6, 创建树形结构
        createTree(rootNode, hTags, 0, maxLevel);

        // 7, 绘制树结构
        var htmlContent = "";
        for (var j = 0; j < rootNode.childNodes.length; j++) {
    //                var element = renderTree(rootNode.childNodes[j], '', 1, j);
    //                directoryOl.appendChild(element);

            htmlContent += renderTree(rootNode.childNodes[j], '', 1, j);
        }
        directoryOl.innerHTML = htmlContent;
    });
</script>

<script>
var wx ,wy;	
$(document).mousemove(function(e){ 
	wx  = e.clientX;
	wy = e.clientY; 
});

$(window).scroll(function() {	

	var _height=$("#toc").height()/3;
	
	var _hh=$("#toc").scrollTop() + $("#toc").find(".active").offset().top - $("#toc").offset().top;		
	
	var d_left = document.getElementById("toc").offsetLeft;
    var d_top = document.getElementById("toc").offsetTop;
    var d_width = document.getElementById("toc").clientWidth;
    var d_height = document.getElementById("toc").clientHeight;

    if(wx < d_left || wy<d_top || wx > (d_left + d_width) || wy > (d_top + d_height)){
		$("#toc").scrollTop(_hh-_height);			
	}
	
});
</script>


<script>
(function(){window.onload = function(){
    console.log('DOM already loaded.');
    if(window.top == window.self){ 
        var aNode = document.createElement('a');
        aNode.href = 'javascript:;';
        aNode.id = 'click-to-top';
        aNode.title = 'Click it to go to the top';
        var availHeight = window.screen.availHeight; // 获取可用高度
        var css = '#click-to-top{ display:none; position: fixed; right: 5%; bottom: 20%; opacity: 0.2; z-index: 9999; } #click-to-top:hover{ position: fixed; right: 5%; bottom: 20%; opacity: 1; z-index: 9999; }';
        //滚出一屏以后才显示返回顶部按钮
        window.onscroll = function(){
            var curPos = (document.documentElement.scrollTop == 0) ? document.body.scrollTop : document.documentElement.scrollTop; //document.documentElement.scrollTop; //preparation for hack (document.documentElement.scrollTop == 0) ? document.body.scrollTop : document.documentElement.scrollTop; 
            if(curPos > availHeight){
                aNode.style.display = 'block';
            }else {
                aNode.style.display = 'none';
            }
        };
        //图片相关
        var img = document.createElement('img');
        img.src = 'https://ooo.0o0.ooo/2017/05/23/59245c636b321.png';
        img.style = 'width: 30px; height: 30px;';
        //样式相关
        var style = document.createElement('style');
        if (style.styleSheet) {
            style.styleSheet.cssText = css;
        } else {
            style.appendChild(document.createTextNode(css));
        }
        document.getElementsByTagName('head')[0].appendChild(style);
        aNode.append(img);
        aNode.addEventListener('click', function(){
            document.body.scrollIntoView();
            /*var timer = setInterval(function(){
            document.documentElement.scrollTop -= 500;
                if(document.documentElement.scrollTop < 100){
                    clearInterval(timer);
                }
            }, 50);
        }, true);*/
        });
        var eBody = document.querySelector('body');
        eBody.append(aNode);
    }
};})();
</script>

<script>
	!function(e, t, a) {
		function r() {
			for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
			requestAnimationFrame(r)
		}
		function n() {
			var t = "function" == typeof e.onclick && e.onclick;
			e.onclick = function(e) {
				t && t(),
					o(e)
			}
		}
		function o(e) {
			var a = t.createElement("div");
			a.className = "heart",
				s.push({
					el: a,
					x: e.clientX - 5,
					y: e.clientY - 5,
					scale: 1,
					alpha: 1,
					color: c()
				}),
				t.body.appendChild(a)
		}
		function i(e) {
			var a = t.createElement("style");
			a.type = "text/css";
			try {
				a.appendChild(t.createTextNode(e))
			} catch(t) {
				a.styleSheet.cssText = e
			}
			t.getElementsByTagName("head")[0].appendChild(a)
		}
		function c() {
			return "rgb(" + ~~ (255 * Math.random()) + "," + ~~ (255 * Math.random()) + "," + ~~ (255 * Math.random()) + ")"
		}
		var s = [];
		e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame ||
			function(e) {
				setTimeout(e, 1e3 / 60)
			},
			i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"),
			n(),
			r()
	} (window, document);
</script>

<style type='text/css'>
html {overflow-x: initial !important;}
:root { /*--bg-color:#ffffff; --text-color:#333333;*/ --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 40px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  html.blink-to-pdf { font-size: 13px; }
  .typora-export #write { padding-left: 32px; padding-right: 32px; padding-bottom: 0px; break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
svg[id^="mermaidChart"] { line-height: 1em; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }


/* 全局属性 */
#write {
  max-width: 860px;
  font-size: 16px;
  color: black;
  padding: 0 10px;
  line-height: 1.6;
  word-spacing: 0px;
  letter-spacing: 0px;
  word-break: break-word;
  word-wrap: break-word;
  text-align: left;
  font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, 'PingFang SC', Cambria, Cochin, Georgia, Times, 'Times New Roman', serif;
}

/*段落*/
#write p {
  font-size: 16px;
  padding-top: 8px;
  padding-bottom: 8px;
  margin: 0;
  line-height: 26px;
  color: black;
}


/*标题*/
#write h1,
#write h2,
#write h3,
#write h4,
#write h5,
#write h6 {
  margin-top: 30px;
  margin-bottom: 15px;
  padding: 0px;
  font-weight: bold;
  color: black;
}
#write h1 {
  font-size: 1.5rem;
}
#write h2 {
  font-size: 1.3rem;
  border-bottom: 2px solid rgb(239, 112, 96);
}
#write h2 span {
 display: inline-block;
 font-weight: bold;
 background: rgb(239, 112, 96);
 color: #ffffff;
 padding: 3px 10px 1px;
 border-top-right-radius: 3px;
 border-top-left-radius: 3px;
 margin-right: 3px;
}
#write h2:after {
 display: inline-block;
 content: "";
 vertical-align: bottom;
 border-bottom: 36px solid #efebe9;
 border-right: 20px solid transparent;
}
#write h3 {
  font-size: 1.2rem;
}
#write h4 {
  font-size: 1.1rem;
}
#write h5 {
  font-size: 1rem;
}
#write h6 {
  font-size: 1rem;
}

/*列表*/
#write ul,
#write ol {
  margin-top: 8px;
  margin-bottom: 8px;
  padding-left: 25px;
  color: black;
}
#write ul {
  list-style-type: disc;
}
#write ul ul {
  list-style-type: square;
}
#write ol {
  list-style-type: decimal;
}
#write li section {
  margin-top: 5px;
  margin-bottom: 5px;
  line-height: 26px;
  text-align: left;
  color: rgb(1,1,1); /* 只要是纯黑色微信编辑器就会把color这个属性吞掉。。。*/
  font-weight: 500;
}

/*引用*/
#write blockquote {
  display: block;
  font-size: 0.9em;
  overflow: auto;
  overflow-scrolling: touch;
  border-left: 3px solid rgb(239, 112, 96);
  color: #6a737d;
  padding: 10px 10px 10px 20px;
  margin-bottom: 20px;
  margin-top: 20px;
  background: #fff9f9;
}
#write blockquote p {
  margin: 0px;
  color: black;
  line-height: 26px;
}

/*链接*/
#write a {
  text-decoration: none;
  word-wrap: break-word;
  font-weight: bold;
  border-bottom: 1px solid #1e6bb8;
  color: rgb(239, 112, 96);
  border-bottom: 1px solid rgb(239, 112, 96);
}

/*行内代码*/
#write p code,
#write li code {
  font-size: 14px;
  word-wrap: break-word;
  padding: 2px 4px;
  border-radius: 4px;
  margin: 0 2px;
  color:  rgb(239, 112, 96);;
  background-color: rgba(27,31,35,.05);
  font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;
  word-break: break-all;
}

/*图片*/
#write img {
  display: block;
  margin: 0 auto;
  max-width: 100%;
}

/*表格*/
#write table {
  display: table;
  text-align: left;
}
#write tbody {
  border: 0;
}
#write table tr {
  border: 0;
  border-top: 1px solid #ccc;
  background-color: white;
}
#write table tr:nth-child(2n) {
  background-color: #F8F8F8;
}
#write table tr th,
#write table tr td {
  font-size: 16px;
  border: 1px solid #ccc;
  padding: 5px 10px;
  text-align: left;
}
#write table tr th {
  font-weight: bold;
  background-color: #f0f0f0;
}

/* 行内代码 */
#write span code, #write li code {
 color: rgb(239, 112, 96);
}

/* 脚注上标 */
#write .md-footnote {
 font-weight: bold;
 color: rgb(239, 112, 96);
}
#write .md-footnote > .md-text:before {
 content: '['
}
#write .md-footnote > .md-text:after {
 content: ']'
}

/* 脚注 */
#write .md-def-name {
  padding-right: 1.8ch;
}
#write .md-def-name:before {
  content: '[';
  color: #000;
}
#write .md-def-name:after {
  color: #000;
}

/* 代码块主题 */
.md-fences:before {
  content: ' ';
  display: block;
  width: 100%;
  background-size: 40px;
  background-repeat: no-repeat;
  background-color: #282c34;
  margin-bottom: -7px;
  border-radius: 5px;
  background-position: 10px 10px;
}
.cm-s-inner.CodeMirror {
  padding-top: .5rem;
  padding-bottom: .5rem;
  background-color: #292d3e;
  color: #a6accd;
  font-family: Consolas;
  border-radius: 4px;
}
.CodeMirror-lines {
  padding-left: 4px;
}
.cm-s-inner .cm-keyword {
  color: #c792ea;
}
.cm-s-inner .cm-operator {
  color: #89ddff;
}
.cm-s-inner .cm-variable-2 {
  color: #eeffff;
}
.cm-s-inner .cm-variable-3,
.cm-s-inner .cm-type {
  color: #f07178;
}
.cm-s-inner .cm-builtin {
  color: #ffcb6b;
}
.cm-s-inner .cm-atom {
  color: #f78c6c;
}
.cm-s-inner .cm-number {
  color: #ff5370;
}
.cm-s-inner .cm-def {
  color: #82aaff;
}
.cm-s-inner .cm-string {
  color: #c3e88d;
}
.cm-s-inner .cm-string-2 {
  color: #f07178;
}
.cm-s-inner .cm-comment {
  color: #676e95;
}
.cm-s-inner .cm-variable {
  color: #f07178;
}
.cm-s-inner .cm-tag {
  color: #ff5370;
}
.cm-s-inner .cm-meta {
  color: #ffcb6b;
}
.cm-s-inner .cm-attribute {
  color: #c792ea;
}
.cm-s-inner .cm-property {
  color: #c792ea;
}
.cm-s-inner .cm-qualifier {
  color: #decb6b;
}
.cm-s-inner .cm-variable-3,
.cm-s-inner .cm-type {
  color: #decb6b;
}
.cm-s-inner .cm-error {
  color: rgba(255, 255, 255, 1);
  background-color: #ff5370;
}
.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: white !important;
}
.CodeMirror div.CodeMirror-cursor {
  border-left: 1px solid rgb(239, 112, 96);
  z-index: 3;
}
</style>

</head>
<body>
<p><a href="https://resume.zhaoshengblog.cn/">返回上一页</a></p>
<h1 id="-"><strong>案例</strong></h1>
<p><strong>基于MySQL的电商⽤户、商品、平台价值分析</strong></p>
<h1 id="1-">1.项目背景</h1>
<blockquote>
<p>随着电商⾏业近⼏年的迅猛发展，电⼦商务从早些年的粗放式经营，逐步转化为精细化运营。<br>随着平台数据量的不断积累，通过数据分析挖掘消费者的潜在需求，消费偏好成为平台运营过程中的重要环节。<br>本项⽬基于某电商平台⽤户⾏为数据，在MYSQL关系型数据库，<br>探索⽤户⾏为规律，寻找⾼价值⽤户；<br>分析商品特征，寻找⾼贡献商品；<br>分析产品功能，优化产品路径。</p>
</blockquote>
<h2 id="-1-1-"><strong>1.1 分析流程</strong></h2>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/%E4%BA%BA%E8%B4%A7%E5%9C%BA%E6%8C%87%E6%A0%87%E4%BD%93%E7%B3%BB.bmp" alt=""></p>
<h1 id="2-">2.使用“人货场”拆解方式建立指标体系</h1>
<p>最终结果：评价‘’⽤户，商品，平台“三者质量</p>
<ul>
<li><strong>⼈货场</strong></li></ul>
<blockquote>
<p>「⼈」（⽤户)是整个运营的核⼼。<br>所有举动都围绕着，如何让更多的⼈有购买⾏为，让他们买的更多，买的更贵。<br>所以对⼈的洞察是⼀切⾏为的基础。<br>⽬前平台上的主⼒消费⼈群有哪些特征，他们对货品有哪些需求，他们活跃在哪些场，还有哪些有消费⼒的⼈⽬前不在平台上，对这些问题的回答指向了接下来的⾏动。</p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>指标</strong></th>
<th><strong>细化指标</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>浏览</td>
<td>PV</td>
<td>（PageView）是⻚⾯浏览量</td>
</tr>
<tr>
<td>/</td>
<td>UV</td>
<td>（Unique Visitor）是⼀定时间内访问⽹⻚的⼈数，正式名称独⽴访客数（⼀个⽹站或者⼀个⻚⾯）</td>
</tr>
<tr>
<td>流量质量</td>
<td>PV/UV</td>
<td>浏览深度</td>
</tr>
<tr>
<td>/</td>
<td>ROI</td>
<td>投资回报率（ROI）=年利润或年均利润/投资总额×100%</td>
</tr>
<tr>
<td>成交⽤户</td>
<td>新客数</td>
<td>（⼀般当天的算新⽤户，当⽇激活或者/新增）</td>
</tr>
<tr>
<td>/</td>
<td>⽼客数</td>
<td>/</td>
</tr>
<tr>
<td>/</td>
<td>客单价</td>
<td>当⽇消费总价/顾客数（新+⽼）—-客单价应该是稳的，突然多/少，购买⼒特别强的，疫情影响客单价下降</td>
</tr>
<tr>
<td>/</td>
<td>DAU</td>
<td>⽇活跃⽤户</td>
</tr>
<tr>
<td>/</td>
<td>MAU</td>
<td>⽉活跃⽤户</td>
</tr>
<tr>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<blockquote>
<p>「货」就对应供给,涉及到了货品分层，哪些是红海，哪些是蓝海，如何进⾏动态调整，是要做⾃营还是平台，以满⾜消费者的需求。<br>「场」就是消费者在什么场景下，以什么样的⽅式接触到了这个商品。早期的导购做的⽐较简单，⽬前的场就⽐较丰富，但也暴露了淘宝和京东在导购⽅⾯的⼀些问题。<br>⽐如内容营销，⽬前最好的可能是微信的KOL⽣态和⼩红书，甚⾄微博，⽽不在电商⾃⼰的场。<br>如何做⼀个全域的打通，和消费者进⾏多触点的接触，⽐如社交和电商联动，来完成销售转化，这就是腾讯和阿⾥⼀直都在讲的「全域营销」。</p>
</blockquote>
<h1 id="3-">3.确认问题</h1>
<blockquote>
<p>  本次分析的⽬的是想通过对⽤户⾏为数据进⾏分析，为以下问题提供解释和改进建议：<br>  1）基于漏⽃模型的⽤户购买流程各环节分析指标，确定各个环节的转换率，便于找到需要改进的环节；<br>  2）商品分析：找出热销商品，研究热销商品特点；<br>  3）基于RFM模型找出核⼼付费⽤户群，对这部分⽤户进⾏精准营销。</p>
</blockquote>
<h1 id="4-">4.准备⼯作</h1>
<h2 id="4-1-">4.1 数据读取(⽤户⾏为数据)</h2>
<p>表结构</p>
<table>
<thead>
<tr>
<th><strong>列名</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>⽤户ID</td>
</tr>
<tr>
<td>item_id</td>
<td>商品ID</td>
</tr>
<tr>
<td>behavior_type</td>
<td>⽤户⾏为类型（1-曝光；2-购买；3-加⼊购物⻋；4-加⼊收藏夹。）</td>
</tr>
<tr>
<td>user_geohash</td>
<td>地理位置</td>
</tr>
<tr>
<td>item_category</td>
<td>品类ID</td>
</tr>
<tr>
<td>time</td>
<td>⽤户⾏为发⽣的时间</td>
</tr>
</tbody>
</table>
<pre><code class="lang-mysql">use lagou;
create table o_retailers_trade_user (
user_id int (9),
item_id int (9),
behavior_type int (1),
user_geohash    varchar (14),
item_category int (5),
time    varchar (13)
);
</code></pre>
<p>注意：样例数据的时间格式如：2019-12-06 02 年-⽉-⽇ ⼩时（24进制）</p>
<h2 id="4-2-">4.2 <strong>数据预处理</strong></h2>
<ul>
<li>增加新列date_time（datetime）,dates（char，年⽉⽇），便于后续时间维度分析；</li></ul>
<pre><code class="lang-mysql">-- 增加新列date_time、dates
alter table o_retailers_trade_user add column date_time datetime null; update o_retailers_trade_user
set date_time =str_to_date(time,&#39;%Y-%m-%d %H&#39;) ;

-- %H可以表示0-23；⽽%h表示0-12
alter table o_retailers_trade_user add column dates char(10) null;
update o_retailers_trade_user set dates=date(date_time);

desc o_retailers_trade_user;
select * from o_retailers_trade_user limit 5;
</code></pre>
<ul>
<li>重复值处理：创建新表a，并插⼊5W条⽆重复数据</li></ul>
<pre><code class="lang-mysql">-- 创建新表a，并插⼊5W条数据。
create table temp_trade like o_retailers_trade_user;
insert into temp_trade select distinct * from o_retailers_trade_user limit 50000;
</code></pre>
<h1 id="-5-"><strong>5.指标体系建设</strong></h1>
<p>⼈ 货 场 体系</p>
<h2 id="5-1-">5.1 <strong>⽤户指标体系</strong></h2>
<p>基础指标体系（UV/PV/留存率）+  RFM模型分析</p>
<h3 id="5-1-1-">5.1.1 <strong>基础指标</strong></h3>
<p>uv、pv、留存率（按⽇）统计</p>
<pre><code class="lang-mysql">/*
需求： uv、 pv、浏览深度（按⽇）统计
pv：统计behavior_type=1的记录数，需要按⽇统计（分组）
uv: 统计distinct user_id 的数量，需要按⽇统计（分组）
浏览深度： pv/uv
*/
-- pv 进⾏cout时候，如果behavior_type=1进⾏计算，如果不是，不进⾏计算
select
dates,
count( distinct user_id ) as &#39;uv&#39;,
count( if(behavior_type=1,user_id,null)) as &#39;pv&#39;,
count( if(behavior_type=1,user_id,null))/count( distinct user_id ) as
&#39;pv/uv&#39;
from
temp_trade
group by
dates;
</code></pre>
<pre><code class="lang-mysql">-- ⽤户留存
with temp_table_trades as
(select a.dates
,count(distinct b.user_id) as device_v
,count(distinct if(datediff(b.dates,a.dates)=0,b.user_id,null)) as device_v_remain0
,count(distinct if(datediff(b.dates,a.dates)=1,b.user_id,null)) as device_v_remain1
,count(distinct if(datediff(b.dates,a.dates)=2,b.user_id,null)) as device_v_remain2
,count(distinct if(datediff(b.dates,a.dates)=3,b.user_id,null)) as device_v_remain3
,count(distinct if(datediff(b.dates,a.dates)=4,b.user_id,null)) as device_v_remain4
,count(distinct if(datediff(b.dates,a.dates)=5,b.user_id,null)) as device_v_remain5
,count(distinct if(datediff(b.dates,a.dates)=6,b.user_id,null)) as device_v_remain6
,count(distinct if(datediff(b.dates,a.dates)=7,b.user_id,null)) as device_v_remain7
,count(distinct if(datediff(b.dates,a.dates)=15,b.user_id,null)) as device_v_remain15
,count(distinct if(datediff(b.dates,a.dates)=30,b.user_id,null)) as device_v_remain30
from
(select
user_id
,dates
from
temp_trade
group by
user_id
,dates ) a
left join
(
select
dates
,user_id
from temp_trade
GROUP BY dates,user_id
) b on a.user_id = b.user_id
where b.dates &gt;= a.dates
group by a.dates)
select dates, device_v_remain0,
concat(cast((device_v_remain1/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_1%&#39;,
concat(cast((device_v_remain2/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_2%&#39;,
concat(cast((device_v_remain3/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_3%&#39;,
concat(cast((device_v_remain4/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_4%&#39;,
concat(cast((device_v_remain5/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_5%&#39;,
concat(cast((device_v_remain6/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_6%&#39;,
concat(cast((device_v_remain7/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_7%&#39;,
concat(cast((device_v_remain15/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_15%&#39;,
concat(cast((device_v_remain30/device_v_remain0)*100 as DECIMAL(18,2)),&#39;%&#39;) as &#39;day_30%&#39;
from temp_table_trades;
</code></pre>
<h3 id="5-1-2-rfm-">5.1.2 <strong>RFM模型分析</strong></h3>
<h4 id="1-rfm-r-">1) RFM模型：R部分</h4>
<pre><code class="lang-mysql">-- RFM模型

-- 1.建⽴R视图，将近期购买时间提取到R临时表中
DROP VIEW
IF
    EXISTS user_recency;
CREATE VIEW user_Recency AS SELECT
user_id,
max( dates ) AS rec_buy_time 
FROM
    temp_trade 
WHERE
    behavior_type = &#39;2&#39; 
GROUP BY
    user_id 
ORDER BY
    rec_buy_time DESC;

-- 2.建⽴R等级划分视图：将客户近期购买时间进⾏等级划分，越接近2019-12-18号R越⼤；
DROP VIEW
IF
    EXISTS r_clevel;
CREATE VIEW r_clevel AS SELECT
user_id,
rec_buy_time,
datediff( &#39;2019-12-18&#39;, rec_buy_time ) AS recen_num,
(
    CASE

            WHEN datediff( &#39;2019-12-18&#39;, rec_buy_time )&lt;= 2 THEN
            5 
            WHEN datediff( &#39;2019-12-18&#39;, rec_buy_time )&lt;= 4 THEN
            4 
            WHEN datediff( &#39;2019-12-18&#39;, rec_buy_time )&lt;= 6 THEN
            3 
            WHEN datediff( &#39;2019-12-18&#39;, rec_buy_time )&lt;= 8 THEN
            2 ELSE 1 
        END 
        ) AS r_value 
FROM
    user_Recency;
</code></pre>
<h4 id="2-rfm-f-">2) RFM模型：F部分（⼀定时间内的消费频率）</h4>
<pre><code class="lang-mysql">-- 1.建⽴F视图
create view frenq_value
as
select user_id ,count(user_id) as buy_frenq
from temp_trade
where behavior_type=&#39;2&#39;
group by user_id;

-- 2.建⽴F等级划分
create view f_clevel
as
select user_id,buy_frenq,
(case when buy_frenq&lt;=2 then 1
when buy_frenq&lt;=4 then 2
when buy_frenq&lt;=6 then 3
when buy_frenq&lt;=8 then 4
else 5 end) as &#39;f_values&#39;
from frenq_value;
select * from f_level;
</code></pre>
<h4 id="3-">3) 整合结果</h4>
<p>本次数据中通过最近消费（R）和消费频率（F）建⽴RFM模型</p>
<ul>
<li>重要⾼价值客户：指最近⼀次消费较近⽽且消费频率较⾼的客户；</li><li>重要唤回客户：指最近⼀次消费较远且消费频率较⾼的客户；</li><li>重要深耕客户：指最近⼀次消费较近且消费频率较低的客户；</li><li>重要挽留客户：指最近⼀次消费较远且消费频率较低的客户；</li></ul>
<p>我们按照最近⼀次消费的均值和消费频率的均值定⾼低界限。</p>
<pre><code class="lang-mysql">-- 将⽤户整合
-- 1.R平均值
SELECT avg(r_value) as &#39;r_avg&#39; FROM r_clevel; -- 2.7939

-- 2.F平均值
select avg(f_values) as &#39;f_avg&#39; from f_clevel; -- 2.2606

-- 3.⽤户⼋⼤类等级划分，由于该数据没有M值，故只建⽴了4个分类
drop view if exists RFM_inall;
create view RFM_inall
as
select a.*,b.f_values,
(case
when a.r_value&gt;2.7939 and b.f_values&gt;2.2606 then &#39;重要⾼价值客户&#39;
when a.r_value&lt;2.7939 and b.f_values&gt;2.2606 then &#39;重要唤回客户&#39;
when a.r_value&gt;2.7939 and b.f_values&lt;2.2606 then &#39;重要深耕客户&#39;
when a.r_value&lt;2.7939 and b.f_values&lt;2.2606 then &#39;重要挽留客户&#39;
END
) as user_class
from r_clevel a, f_clevel b
where a.user_id=b.user_id;
SELECT count(user_id) as user_v,user_class from RFM_inall GROUP BY user_class;
</code></pre>
<h2 id="5-2-">5.2 <strong>商品指标体系</strong></h2>
<p>商品的点击量 收藏量 加购量 购买次数<br>购买转化（该商品的所有⽤户中有购买转化的⽤户⽐；）按照商品进⾏分组统计</p>
<pre><code class="lang-mysql">-- 商品的点击量 收藏量 加购量 购买次数 购买转化
select * from temp_trade;
select item_id,
sum(case when behavior_type=1 then 1 else 0 end) as&#39;pv&#39;,
sum(case when behavior_type=4 then 1 else 0 end) as&#39;fav&#39;,
sum(case when behavior_type=3 then 1 else 0 end) as&#39;cart&#39;,
sum(case when behavior_type=2 then 1 else 0 end) as&#39;buy&#39;,
count(distinct case when behavior_type=2 then user_id else null
end)/count(distinct user_id) as buy_rate
from temp_trade
group by item_id
order by buy desc;
</code></pre>
<p>对应品类的点击量 收藏量 加购量 购买次数 购买转化（该商品品类的所有⽤户中有购买转化的⽤户⽐；）</p>
<pre><code class="lang-mysql">select item_category,
sum(case when behavior_type=1 then 1 else 0 end) as&#39;pv&#39;,
sum(case when behavior_type=4 then 1 else 0 end) as&#39;fav&#39;,
sum(case when behavior_type=3 then 1 else 0 end) as&#39;cart&#39;,
sum(case when behavior_type=2 then 1 else 0 end) as&#39;buy&#39;,
count(distinct case when behavior_type=2 then user_id else null
end)/count(distinct user_id) as buy_rate
from temp_trade
group by item_category
order by buy desc;
</code></pre>
<h2 id="5-3-">5.3<strong>平台指标体系</strong></h2>
<h3 id="1-">1) ⾏为指标：</h3>
<p>点击次数 收藏次数 加购物⻋次数 购买次数 购买转化（该平台当⽇的所有⽤户中有购买转化的⽤户⽐）</p>
<pre><code class="lang-mysql">-- 每⽇的分析(1-4，分别表示点击pv、购买buy、加购物⻋cart、喜欢fav)

select dates,count(1) as &#39;每⽇的总数&#39;,
sum(case when behavior_type=1 then 1 else 0 end) as&#39;pv&#39;, sum(case when behavior_type=2 then 1 else 0 end) as&#39;buy&#39;, sum(case when behavior_type=3 then 1 else 0 end) as&#39;cart&#39;, sum(case when behavior_type=4 then 1 else 0 end) as&#39;fav&#39;, count(distinct case when behavior_type=2 then user_id else null end)/count(distinct user_id) as buy_rate
from temp_trade group by dates;
</code></pre>
<ul>
<li><strong>⾏为路径分析</strong></li></ul>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/image-20200908150617909.png" alt="image-20200908150617909"></p>
<pre><code class="lang-mysql">-- ⾏为路径分析

-- ⾏为路径组建基础视图
drop view product_user_way;
create view product_user_way as select
a.*
from
(
select
user_id,
item_id,
lag ( behavior_type, 4 ) over ( partition by user_id, item_id order bydate_time ) lag_4,
lag ( behavior_type, 3 ) over ( partition by user_id, item_id order bydate_time ) lag_3,
lag ( behavior_type, 2 ) over ( partition by user_id, item_id order bydate_time ) lag_2,
lag ( behavior_type, 1 ) over ( partition by user_id, item_id order bydate_time ) lag_1,
behavior_type,
rank ( ) over ( partition by user_id, item_id order by date_time desc ) as
rank_dn # 倒数第⼏个⾏为
from
temp_trade
) a
where
a.rank_dn = 1
and behavior_type = 2

-- 查询该路径下有多少购买⽤户数
select
concat(
ifnull( lag_4, &#39;空&#39; ),
&quot;-&quot;,
ifnull( lag_3, &#39;空&#39; ),
&quot;-&quot;,
ifnull( lag_2, &#39;空&#39; ),
&quot;-&quot;,
ifnull( lag_1, &#39;空&#39; ),
&quot;-&quot;,
behavior_type
) as user_way,
count( distinct user_id ) as user_count 

-- 该路径下购买⽤户数
from
product_user_way
group by
concat(
ifnull( lag_4, &#39;空&#39; ),
&quot;-&quot;,
ifnull( lag_3, &#39;空&#39; ),
&quot;-&quot;,
ifnull( lag_2, &#39;空&#39; ),
&quot;-&quot;,
ifnull( lag_1, &#39;空&#39; ),
&quot;-&quot;,
behavior_type
);
</code></pre>
<ul>
<li>SQL汇总</li></ul>
<pre><code class="lang-mysql">CREATE TABLE o_retailers_trade_user (
    user_id INT ( 9 ),
    item_id INT ( 9 ),
    behavior_type INT ( 1 ),
    user_geohash VARCHAR ( 14 ),
    item_category INT ( 5 ),
time VARCHAR ( 13 ) 
);


SELECT
    * 
FROM
    o_retailers_trade_user 
    LIMIT 5;


-- 增加新列date_time、dates
ALTER TABLE o_retailers_trade_user ADD COLUMN date_time datetime NULL;

-- date_time 字段来自于基础数据中time字段
UPDATE o_retailers_trade_user 
SET date_time = str_to_date( time, &#39;%Y-%m-%d %H&#39; );-- 大H代表24进制，小h代表12进制

-- %H可以表示0-23；⽽%h表示0-12
alter table o_retailers_trade_user add column dates char(10) null;

-- dates 字段来自于基础数据中time字段
update o_retailers_trade_user set dates=date(date_time);

-- 查看表结构
desc o_retailers_trade_user;


-- 去重预处理
create table temp_trade like o_retailers_trade_user;

insert into temp_trade select distinct * from o_retailers_trade_user limit 50000;

/*
需求：UV、PV、按日留存率统计

pv：统计behavior_type=1的记录数，需要按日统计（分组）
uv: 统计distinct user_id 的数量，需要按日统计（分组）
浏览深度/浏览质量：pv/uv
*/
-- pv 计算count的时候，如果behavior_type=1进行计算，如果不是，不进行计算
SELECT
    dates,
    count( DISTINCT user_id ) AS &#39;uv&#39;,
    count(
    IF
    ( behavior_type = 1, user_id, NULL )) AS &#39;pv&#39;,
    count(
    IF
    ( behavior_type = 1, user_id, NULL ))  / count( DISTINCT user_id )  AS &#39;pv/uv&#39; 
FROM
    temp_trade 
GROUP BY
    dates;


/*
留存率（按日）统计
活跃用户留存率（某天189个用户活跃，过了3天后剩下58个人活跃）
日期/活跃用户/过了1天/过了2天
2019-12-28 / 100 / 90（98%）/ 80（80%）
1）获取到类似于上面的一个结果集
2）基础数据中所有的日都应该进行如上的计算
*/
-- 自关联的方式
SELECT
    user_id,
    dates 
FROM
    temp_trade 
GROUP BY
    user_id,
    dates;

CREATE VIEW user_remain_view AS
SELECT
    a.dates,
    count( DISTINCT b.user_id ) AS &#39;user_count&#39;,
    count( DISTINCT IF(datediff( b.dates,a.dates )=1,b.user_id,null)) AS remain1, -- 1日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=2,b.user_id,null)) AS remain2, -- 2日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=3,b.user_id,null)) AS remain3, -- 3日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=4,b.user_id,null)) AS remain4, -- 4日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=5,b.user_id,null)) AS remain5, -- 5日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=6,b.user_id,null)) AS remain6, -- 6日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=7,b.user_id,null)) AS remain7, -- 7日留存数计算
        count( DISTINCT IF(datediff( b.dates,a.dates )=15,b.user_id,null)) AS remain15, -- 15日留存数计算
    count( DISTINCT IF(datediff( b.dates,a.dates )=30,b.user_id,null)) AS remain30 -- 30日留存数计算
FROM
    ( SELECT user_id, dates FROM temp_trade GROUP BY user_id, dates ) a
    LEFT JOIN ( SELECT user_id, dates FROM temp_trade GROUP BY user_id, dates ) b ON a.user_id = b.user_id 
WHERE
    b.dates &gt;= a.dates 
GROUP BY
    a.dates;

-- cast 转换函数  CAST函数语法规则是：Cast(字段名 as 转换的类型 )，其中类型可以为：CHAR[(N)] 字符型 、DATE 日期型、DATETIME 日期和时间型、DECIMAL float型、SIGNED int、TIME 时间型
-- decimal 数据类型最多可存储 38 个数字,所有数字都能够放到小数点的右边.decimal 数据类型存储了一个准确（精确）的数字表达法；不存储值的近似值.其中10是小数点左边和右边的数字个数之和(不包括小数点),2代表小数点右边的小数位数或数字个数.decimal(10,2)可以存储8位整数2位小数的数字
SELECT
    dates,
    user_count,
    concat(cast((remain1 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain1_rate&#39;,  -- 1日留存率
    concat(cast((remain2 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain2_rate&#39;,  -- 2日留存率
    concat(cast((remain3 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain3_rate&#39;,  -- 3日留存率
    concat(cast((remain4 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain4_rate&#39;,  -- 4日留存率
    concat(cast((remain5 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain5_rate&#39;,  -- 5日留存率
    concat(cast((remain6 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain6_rate&#39;,  -- 6日留存率
    concat(cast((remain7 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain7_rate&#39;,  -- 7日留存率
    concat(cast((remain15 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain15_rate&#39;,  -- 15日留存率
    concat(cast((remain30 / user_count)*100 AS DECIMAL(10,2)),&#39;%&#39;) AS &#39;remain30_rate&#39;  -- 30日留存率
FROM
    user_remain_view

-- R 指标分析：根据每个用户最近一次购买时间，给出相应的分数

-- 每个用户的最近购买时间
DROP VIEW IF EXISTS user_recency_view;
CREATE VIEW user_recency_view AS
SELECT 
  user_id,
    max(dates) AS recent_buy_time
FROM temp_trade
WHERE behavior_type=2
GROUP BY user_id;

-- 计算每个用户的最近购买时间距离 2019-12-18相差几天，根据相差天数给予一定的分数
CREATE VIEW r_level AS
SELECT
  user_id,
    recent_buy_time,
    DATEDIFF(&#39;2019-12-18&#39;,recent_buy_time),
    -- &lt;=2 5分、&lt;=4 4分、&lt;=6 3分、&lt;=8 2分、其他 1分
    (
    CASE 
    WHEN DATEDIFF(&#39;2019-12-18&#39;,recent_buy_time)&lt;=2 THEN 5
    WHEN DATEDIFF(&#39;2019-12-18&#39;,recent_buy_time)&lt;=4 THEN 4
    WHEN DATEDIFF(&#39;2019-12-18&#39;,recent_buy_time)&lt;=6 THEN 3
    WHEN DATEDIFF(&#39;2019-12-18&#39;,recent_buy_time)&lt;=8 THEN 2
    ELSE 1 END
    ) AS r_value -- 判断具体某个人的分值
FROM user_recency_view;


-- f指标计算：求出每个用户的消费次数或者购买次数，拿到消费次数对消费情况进行评分
-- 求出每个用户的消费次数或者购买次数
CREATE VIEW user_buy_fre_view AS
SELECT
  user_id,
    COUNT(user_id) AS buy_frequency -- 哥哥用户购买次数
FROM temp_trade
WHERE behavior_type=2
GROUP BY user_id;

-- 评分：购买次数&lt;=2 1分、&lt;=4 2分、&lt;=6 3分、&lt;=8 4分、其他 5分
CREATE VIEW f_level AS
SELECT
  user_id,
    buy_frequency,
    ( case
    when buy_frequency&lt;=2 then 1
    when buy_frequency&lt;=4 then 2
    when buy_frequency&lt;=6 then 3
    when buy_frequency&lt;=8 then 4
    else 5 end
    ) as &#39;f_value&#39;
FROM user_buy_fre_view;

-- r均值
SELECT
  AVG(r_value) AS &#39;r_avg&#39;
FROM r_level; -- 2.7939


-- f均值
SELECT
  AVG(f_value) AS &#39;f_avg&#39;
FROM f_level; -- 2.2606

-- 重要价值客户：指最近⼀次消费较近⽽且消费频率较⾼的客户；
-- 重要唤回客户：指最近⼀次消费较远且消费频率较⾼的客户；
-- 重要深耕客户：指最近⼀次消费较近且消费频率较低的客户；
-- 重要挽留客户：指最近⼀次消费较远且消费频率较低的客户；

-- 拿到每个人的r值和f值(两表关联 r_level\f_level)，与均值对比
select
r.user_id,
r.r_value,
f.f_value,
(
case
when r.r_value&gt;2.7939 and f.f_value&gt;2.2606 then &#39;重要价值客户&#39;
when r.r_value&lt;2.7939 and f.f_value&gt;2.2606 then &#39;重要唤回客户&#39;
when r.r_value&gt;2.7939 and f.f_value&lt;2.2606 then &#39;重要深耕客户&#39;
when r.r_value&lt;2.7939 and f.f_value&lt;2.2606 then &#39;重要挽留客户&#39;
end -- 没有其他就别else
) AS user_type
from r_level r,f_level f where r.user_id=f.user_id;

-- 商品的点击量 收藏量 加购量 购买次数 购买转化
select 
  item_id,
    sum(case when behavior_type=1 then 1 else 0 end ) as &#39;pv&#39;, -- 点击量
    sum(case when behavior_type=4 then 1 else 0 end ) as &#39;fav&#39;, -- 收藏量
    sum(case when behavior_type=3 then 1 else 0 end ) as &#39;cart&#39;, -- 加购量
    sum(case when behavior_type=2 then 1 else 0 end ) as &#39;buy&#39; -- 购买次数
from temp_trade group by item_id;


-- 对应品类的点击量 收藏量 加购量 购买次数 购买转化,该商品品类的所有用户中有购买转化的用户比
select 
  item_category,
    sum(case when behavior_type=1 then 1 else 0 end ) as &#39;pv&#39;, -- 点击量
    sum(case when behavior_type=4 then 1 else 0 end ) as &#39;fav&#39;, -- 收藏量
    sum(case when behavior_type=3 then 1 else 0 end ) as &#39;cart&#39;, -- 加购量
    sum(case when behavior_type=2 then 1 else 0 end ) as &#39;buy&#39;, -- 购买次数
    count( distinct case when behavior_type=2 then user_id else null end )/count( distinct user_id ) as &#39;buy_rate&#39;
from temp_trade group by item_category;

-- 每日的分析(1-4，分别表示点击pv、购买buy、加购物车buy、喜欢fav)
select 
  dates,
    sum(case when behavior_type=1 then 1 else 0 end ) as &#39;pv&#39;, -- 点击量
    sum(case when behavior_type=4 then 1 else 0 end ) as &#39;fav&#39;, -- 收藏量
    sum(case when behavior_type=3 then 1 else 0 end ) as &#39;cart&#39;, -- 加购量
    sum(case when behavior_type=2 then 1 else 0 end ) as &#39;buy&#39;, -- 购买次数
    count( distinct case when behavior_type=2 then user_id else null end )/count( distinct user_id ) as &#39;buy_rate&#39;
from temp_trade
group by dates;

/*
行为路径分析
核心：拼接行为路径
把多个行为并列摆放，才能使用 concat函数进行拼接
偏移分析函数1 ag over1 ead over---窗口函数，分组（用户+商品），排序（升序）
*/

-- 用户行为拼接准备
drop view path_base_view
create view path_base_view as 
select a.* from 
(
    SELECT
        user_id, item_id,
        lag ( behavior_type, 4 ) over ( PARTITION BY user_id, item_id ORDER BY date_time ) lag_4,-- 1
        lag ( behavior_type, 3 ) over ( PARTITION BY user_id, item_id ORDER BY date_time ) lag_3,-- 1
        lag ( behavior_type, 2 ) over ( PARTITION BY user_id, item_id ORDER BY date_time ) lag_2,-- 1
        lag ( behavior_type, 1 ) over ( PARTITION BY user_id, item_id ORDER BY date_time ) lag_1,-- 1
        behavior_type,
        rank () over ( PARTITION BY user_id, item_id ORDER BY date_time DESC )  rank_number
    FROM
        temp_trade
) a
where a.rank_number=1 and a.behavior_type=2;


-- 拼接行为路径
select concat(ifnull(lag_4,&#39;空&#39;),&#39;-&#39;,ifnull(lag_3,&#39;空&#39;),&#39;-&#39;,ifnull(lag_2,&#39;空&#39;),&#39;-&#39;,ifnull(lag_1,&#39;空&#39;),&#39;-&#39;,behavior_type) path_base 
from path_base_view;


-- 针对行为路径进行分组count统计
select concat(ifnull(lag_4,&#39;空&#39;),&#39;-&#39;,ifnull(lag_3,&#39;空&#39;),&#39;-&#39;,ifnull(lag_2,&#39;空&#39;),&#39;-&#39;,ifnull(lag_1,&#39;空&#39;),&#39;-&#39;,behavior_type) path_base,count(distinct user_id) user_num
from path_base_view
group by path_base;
</code></pre>
<h1 id="6-">6.结论</h1>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai35.JPG" alt=""></p>
<blockquote>
<p><strong>1.双十二活动效果预热明显</strong>：双十二前（11月18-12月8日）日均活跃用户数237人，日均周环比增长2%，用户稳定增长，说明前期活动预热效果明显；<br><strong>2.已挖掘出部分高价值用户</strong>：已经挖掘出来54个重要深耕用户、34个重要高价值用户、70个重要挽留用户。后续运营活动可以直接使用；<br><strong>3.头部商品品类基本保持正常转化率</strong>：头部商品品类基本保持正常平均转化率10.4%，部分品类’5027‘、’5399‘转化率偏低，需要后续与商品运营团队沟通方案；<br><strong>4.购物车转化率偏低</strong>：在所有的消费路径中，58%的用户有加入购物车的行为；但仅有0.6%的用户在加入购物车之后发生购买；说明加入购物车购买转化率偏低的情况，后续与产品团队协商改进建议。<br><strong>5.留存率保持稳定但没有明显的上升势头</strong>：用户留存率基本稳定在60%-70%之间，活动期间会明显上升至80%左右，因此可通过有针对性的市场营销方式来奖励那些保持每月回访的客户，或者是采用一些激励手段，使得每月访问次数少于一次的客户更频繁地回访。引导新用户快速体验核心功能或内容，提高短期留存；同时找到上瘾回路，培养用户习惯，提高长期留存。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai33.JPG" alt=""></p>
<h3 id="-">指标、数据说明</h3>
<blockquote>
<p>1.<strong>统计周期：</strong>2019年11月18日至2019年12月18日。<br>2.<strong>当日UV：</strong>指当日的用户排重计数；</p>
<p>3.<strong>重要高价值客户：</strong>指最近一次消费较近而且消费频率较高的客户；<br>4.<strong>重要唤回客户：</strong>指最近一次消费较远且消费频率较高的客户；<br>5.<strong>重要深耕客户：</strong>指最近一次消费较近且消费频率较低的客户；<br>6.<strong>重要挽留客户：</strong>指最近一次消费较远且消费频率较低的客户；<br>7.<strong>购买转化率：</strong>商品的被购买次数除以所有对商品的行为数；</p>
<p>8.<strong>留存用户：</strong>指某个时间段的新增用户，经过一段时期，仍使用程序的用户。该指标可以用来掌握用户的粘性及忠诚度；<br>9.<strong>用户留存率：</strong>留存率=登录用户数/新增用户数*100%；留存用户和留存率体现了应用的质量和保留用户的能力；</p>
<p>10.<strong>次日留存率：</strong>（第一天新增用户数，第2天还登录的用户数）/第一天总注册用户数；<br>11.<strong>7日留存率：</strong>（第一天新增用户数，第8天还登录的用户数）/第一天总注册用户数；<br>12.<strong>30日留存率：</strong>（第一天新增用户数，第31天还登录的用户数）/第一天总注册用户。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai34.JPG" alt=""></p>
<h2 id="6-1-">6.1 ⽤户分析</h2>
<p>UV异常分析：每⽇UV数据中，明显异常点为双⼗⼆活动造成，该影响为已知影响。</p>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/image-20200908150824108.png" alt="image-20200908150824108"></p>
<blockquote>
<p>  对于UV周环⽐的分析：⽇常周环⽐数据⼤多⼤于0，说明⽤户程⼀定上升趋势，其中如11⽉26⽇、12⽉<br>  2⽇、12⽉7⽇等的数据为下降数据，需要结合其他数据做进⼀步的下降原因分析。双⼗⼆活动后⽤户周环⽐会相应下降，为正常原因。<br>  猜测可能的问题有：<br>  内部问题：产品BUG（⽹站bug）、策略问题（周年庆活动结束了）、营销问题（代⾔⼈换了）等；<br>  外部问题：竞品活动问题（其他平台⼤酬宾），政治环境问题（进⼝商品限制），舆情⼝碑问题（平台商品爆出质量问题）等；</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/image-20200908150845456.png" alt="image-20200908150845456"></p>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai36.JPG" alt=""></p>
<h2 id="6-2-">6.2 <strong>用户精细化运营</strong></h2>
<blockquote>
<p>  通过RFM模型中的⽤户最近⼀次购买时间、⽤户消费频次分析，分拆得到以下重要⽤户。<br>  可以在后续精细化运营场景中直接使⽤细分⽤户，做差异化运营：<br>  对⾼价值客户做VIP服务设计，增加⽤户粘性同时通过设计优惠券提升客户消费；<br>  对深耕客户做⼴告、推送刺激，提升消费频次；<br>  对挽留客户做优惠券、签到送礼策略，增加挽留⽤户粘性；<br>  对唤回客户做定向⼴告、短信召回策略，尝试召回⽤户。</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/image-20200908150910168.png" alt="image-20200908150910168"></p>
<h2 id="6-3-">6.3 <strong>商品分析</strong></h2>
<p>热销商品品类如下所示。</p>
<p>其中’5027‘、’5399‘品类购买转化率较其余商品品类偏低，需要结合更多数据做进⼀步解读。（可能的原因：品类⾃有特性导致⽤户购买较低，⽐如⾮必需品、奢侈品等等。）</p>
<table>
<thead>
<tr>
<th><strong>item_category</strong></th>
<th><strong>pv</strong></th>
<th><strong>fav</strong></th>
<th><strong>cart</strong></th>
<th><strong>buy</strong></th>
<th><strong>buy_rate</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>13230</td>
<td>1481</td>
<td>2</td>
<td>35</td>
<td>43</td>
<td>12.5%</td>
</tr>
<tr>
<td>5894</td>
<td>1336</td>
<td>2</td>
<td>20</td>
<td>36</td>
<td>12.4%</td>
</tr>
<tr>
<td>1863</td>
<td>1461</td>
<td>11</td>
<td>41</td>
<td>34</td>
<td>11.4%</td>
</tr>
<tr>
<td>6513</td>
<td>1030</td>
<td>7</td>
<td>29</td>
<td>31</td>
<td>13.4%</td>
</tr>
<tr>
<td>11279</td>
<td>767</td>
<td>4</td>
<td>22</td>
<td>25</td>
<td>12.6%</td>
</tr>
<tr>
<td>10894</td>
<td>491</td>
<td>2</td>
<td>15</td>
<td>20</td>
<td>12.6%</td>
</tr>
<tr>
<td>5027</td>
<td>1498</td>
<td>2</td>
<td>27</td>
<td>19</td>
<td>7.3%</td>
</tr>
<tr>
<td>2825</td>
<td>608</td>
<td>0</td>
<td>11</td>
<td>15</td>
<td>9.3%</td>
</tr>
<tr>
<td>5399</td>
<td>1131</td>
<td>4</td>
<td>18</td>
<td>15</td>
<td>4.9%</td>
</tr>
<tr>
<td>3628</td>
<td>316</td>
<td>6</td>
<td>6</td>
<td>13</td>
<td>8.0%</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai37.JPG" alt=""><br><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai38.JPG" alt=""></p>
<h2 id="6-4-">6.4 <strong>产品功能路径分析</strong></h2>
<p>以下为主要购买路径。可以发现⽤户多以直接购买为主；添加购物⻋的购买在主要购买路径中数量较少。后续的产品加购功能和产品收藏功能还需要结合更多数据做改进⽅案。</p>
<table>
<thead>
<tr>
<th><strong>user_way</strong></th>
<th><strong>uv</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>空-空-空-空-2</td>
<td>146</td>
</tr>
<tr>
<td>空-空-空-1-2</td>
<td>64</td>
</tr>
<tr>
<td>空-空-1-1-2</td>
<td>10</td>
</tr>
<tr>
<td>空-空-2-1-2</td>
<td>2</td>
</tr>
<tr>
<td>空-空-空-3-2</td>
<td>2</td>
</tr>
<tr>
<td>空-1-1-1-2</td>
<td>1</td>
</tr>
<tr>
<td>空-空-1-3-2</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai31.JPG" alt=""></p>
<h2 id="6-5-">6.5 留存分析</h2>
<p>以下是按日统计的留存率统计图表。<br>通过留存效果曲线可以发现用户的日留存率集中保持在60%-70%之间，用户留存效果保持较好；<br>双12活动效果明显，用户留存达到最高80%左右，活动结束后，用户留存率突降但仍保持在60%-70%之间；<br>细分发现此阶段除双12当天外用户留存量保持稳定但没有显著上升，也就是说并没有大规模拉新活动。</p>
<table>
<thead>
<tr>
<th><strong>日期</strong></th>
<th><strong>1日留存率</strong></th>
<th><strong>2日留存率</strong></th>
<th><strong>3日留存率</strong></th>
<th><strong>4日留存率</strong></th>
<th><strong>5日留存率</strong></th>
<th><strong>6日留存率</strong></th>
<th><strong>7日留存率</strong></th>
<th><strong>15日留存率</strong></th>
<th><strong>30日留存率</strong></th>
<th><strong>留存用户数</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>2019-11-18</td>
<td>65.04%</td>
<td>64.60%</td>
<td>60.18%</td>
<td>61.95%</td>
<td>63.27%</td>
<td>56.19%</td>
<td>60.18%</td>
<td>60.18%</td>
<td>56.64%</td>
<td>226</td>
</tr>
<tr>
<td>2019-11-19</td>
<td>69.37%</td>
<td>63.51%</td>
<td>61.71%</td>
<td>63.51%</td>
<td>65.77%</td>
<td>65.32%</td>
<td>57.21%</td>
<td>60.81%</td>
<td>0.00%</td>
<td>222</td>
</tr>
<tr>
<td>2019-11-20</td>
<td>63.20%</td>
<td>59.31%</td>
<td>61.90%</td>
<td>64.94%</td>
<td>62.77%</td>
<td>56.71%</td>
<td>57.14%</td>
<td>61.47%</td>
<td>0.00%</td>
<td>231</td>
</tr>
<tr>
<td>2019-11-21</td>
<td>62.07%</td>
<td>62.93%</td>
<td>65.09%</td>
<td>65.52%</td>
<td>58.19%</td>
<td>61.21%</td>
<td>62.50%</td>
<td>61.64%</td>
<td>0.00%</td>
<td>232</td>
</tr>
<tr>
<td>2019-11-22</td>
<td>69.47%</td>
<td>64.16%</td>
<td>65.49%</td>
<td>60.18%</td>
<td>64.60%</td>
<td>61.95%</td>
<td>63.27%</td>
<td>60.18%</td>
<td>0.00%</td>
<td>226</td>
</tr>
<tr>
<td>2019-11-23</td>
<td>66.80%</td>
<td>66.39%</td>
<td>58.51%</td>
<td>61.00%</td>
<td>63.07%</td>
<td>65.56%</td>
<td>63.49%</td>
<td>59.75%</td>
<td>0.00%</td>
<td>241</td>
</tr>
<tr>
<td>2019-11-24</td>
<td>69.07%</td>
<td>63.98%</td>
<td>66.53%</td>
<td>65.25%</td>
<td>66.53%</td>
<td>68.22%</td>
<td>65.25%</td>
<td>63.14%</td>
<td>0.00%</td>
<td>236</td>
</tr>
<tr>
<td>2019-11-25</td>
<td>64.61%</td>
<td>63.37%</td>
<td>66.26%</td>
<td>63.37%</td>
<td>68.72%</td>
<td>62.96%</td>
<td>61.73%</td>
<td>64.61%</td>
<td>0.00%</td>
<td>243</td>
</tr>
<tr>
<td>2019-11-26</td>
<td>67.87%</td>
<td>67.42%</td>
<td>65.16%</td>
<td>63.80%</td>
<td>61.54%</td>
<td>59.73%</td>
<td>56.56%</td>
<td>69.23%</td>
<td>0.00%</td>
<td>221</td>
</tr>
<tr>
<td>2019-11-27</td>
<td>70.69%</td>
<td>66.38%</td>
<td>65.52%</td>
<td>67.24%</td>
<td>61.64%</td>
<td>59.48%</td>
<td>62.07%</td>
<td>78.88%</td>
<td>0.00%</td>
<td>232</td>
</tr>
<tr>
<td>2019-11-28</td>
<td>67.92%</td>
<td>63.33%</td>
<td>64.17%</td>
<td>59.17%</td>
<td>61.25%</td>
<td>58.75%</td>
<td>57.50%</td>
<td>62.08%</td>
<td>0.00%</td>
<td>240</td>
</tr>
<tr>
<td>2019-11-29</td>
<td>69.55%</td>
<td>67.49%</td>
<td>63.79%</td>
<td>60.49%</td>
<td>60.08%</td>
<td>62.96%</td>
<td>67.08%</td>
<td>57.61%</td>
<td>0.00%</td>
<td>243</td>
</tr>
<tr>
<td>2019-11-30</td>
<td>63.52%</td>
<td>68.03%</td>
<td>64.75%</td>
<td>65.98%</td>
<td>64.34%</td>
<td>66.39%</td>
<td>64.75%</td>
<td>61.07%</td>
<td>0.00%</td>
<td>244</td>
</tr>
<tr>
<td>2019-12-1</td>
<td>66.12%</td>
<td>60.41%</td>
<td>66.12%</td>
<td>67.35%</td>
<td>64.49%</td>
<td>62.45%</td>
<td>63.27%</td>
<td>61.22%</td>
<td>0.00%</td>
<td>245</td>
</tr>
<tr>
<td>2019-12-2</td>
<td>67.22%</td>
<td>66.80%</td>
<td>67.22%</td>
<td>66.80%</td>
<td>65.56%</td>
<td>64.32%</td>
<td>64.73%</td>
<td>62.24%</td>
<td>0.00%</td>
<td>241</td>
</tr>
<tr>
<td>2019-12-3</td>
<td>69.79%</td>
<td>67.23%</td>
<td>67.23%</td>
<td>65.11%</td>
<td>65.11%</td>
<td>65.96%</td>
<td>66.38%</td>
<td>55.32%</td>
<td>0.00%</td>
<td>235</td>
</tr>
<tr>
<td>2019-12-4</td>
<td>68.02%</td>
<td>68.42%</td>
<td>65.99%</td>
<td>65.99%</td>
<td>62.75%</td>
<td>65.59%</td>
<td>66.80%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>247</td>
</tr>
<tr>
<td>2019-12-5</td>
<td>68.18%</td>
<td>64.05%</td>
<td>65.70%</td>
<td>66.12%</td>
<td>65.29%</td>
<td>69.83%</td>
<td>80.99%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>242</td>
</tr>
<tr>
<td>2019-12-6</td>
<td>65.20%</td>
<td>64.40%</td>
<td>64.40%</td>
<td>64.80%</td>
<td>70.00%</td>
<td>82.00%</td>
<td>61.60%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>250</td>
</tr>
<tr>
<td>2019-12-7</td>
<td>69.29%</td>
<td>68.46%</td>
<td>69.71%</td>
<td>71.78%</td>
<td>81.33%</td>
<td>62.24%</td>
<td>62.24%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>241</td>
</tr>
<tr>
<td>2019-12-8</td>
<td>69.23%</td>
<td>70.04%</td>
<td>73.28%</td>
<td>81.38%</td>
<td>64.37%</td>
<td>65.99%</td>
<td>61.94%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>247</td>
</tr>
<tr>
<td>2019-12-9</td>
<td>68.92%</td>
<td>70.52%</td>
<td>80.48%</td>
<td>61.75%</td>
<td>56.97%</td>
<td>61.75%</td>
<td>59.36%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>251</td>
</tr>
<tr>
<td>2019-12-10</td>
<td>74.80%</td>
<td>81.50%</td>
<td>65.35%</td>
<td>57.87%</td>
<td>62.99%</td>
<td>61.02%</td>
<td>64.17%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>254</td>
</tr>
<tr>
<td>2019-12-11</td>
<td>82.35%</td>
<td>63.97%</td>
<td>61.03%</td>
<td>61.76%</td>
<td>58.46%</td>
<td>61.03%</td>
<td>55.15%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>272</td>
</tr>
<tr>
<td>2019-12-12</td>
<td>62.65%</td>
<td>59.57%</td>
<td>60.19%</td>
<td>57.72%</td>
<td>58.64%</td>
<td>54.94%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>324</td>
</tr>
<tr>
<td>2019-12-13</td>
<td>63.27%</td>
<td>66.12%</td>
<td>59.59%</td>
<td>65.31%</td>
<td>59.18%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>245</td>
</tr>
<tr>
<td>2019-12-14</td>
<td>68.51%</td>
<td>64.68%</td>
<td>64.26%</td>
<td>59.57%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>235</td>
</tr>
<tr>
<td>2019-12-15</td>
<td>69.14%</td>
<td>65.02%</td>
<td>57.61%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>243</td>
</tr>
<tr>
<td>2019-12-16</td>
<td>67.76%</td>
<td>58.37%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>245</td>
</tr>
<tr>
<td>2019-12-17</td>
<td>64.71%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>238</td>
</tr>
<tr>
<td>2019-12-18</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>0.00%</td>
<td>224</td>
</tr>
</tbody>
</table>
<p><img src="https://cdn.jsdelivr.net/gh/zhaoshengblog/Picbed/img/mokuai32.JPG" alt=""></p>
<hr>

</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
